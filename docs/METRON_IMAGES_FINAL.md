# üñºÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Metron (–§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ URL

```typescript
// –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º Metron
api/image/scale_large/12345.jpg ‚úÖ

// –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
/a/uploads/scale_large/12345.jpg ‚úÖ
```

**–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ª–∏—á–∏—è `api/image/` –≤ URL.

### 2. –ó–∞–ø—Ä–æ—Å –∫ Metron API

```typescript
GET https://metron.cloud/api/v1/issue/?cv_id={comicvineId}
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 12345,
    "cv_id": 4050-12345,
    "image": "https://static.metron.cloud/media/issue/2020/08/04/thor-v2-32.jpg"
  }
]
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ `image` –Ω–∞–ø—Ä—è–º—É—é** - —ç—Ç–æ –ø–æ–ª–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞:
```json
{
  "cachedImages": {
    "4050-12345": "https://static.metron.cloud/media/issue/2020/08/04/thor-v2-32.jpg"
  },
  "checkedIds": ["4050-11111", "4050-22222"]
}
```

- `cachedImages` - ID —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∏—Ö URL
- `checkedIds` - ID, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ)

### 4. –õ–∏–º–∏—Ç—ã API

- **–ó–∞–¥–µ—Ä–∂–∫–∞:** 4 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ = **15 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω** (–≤–º–µ—Å—Ç–æ 30)
- **–õ–∏–º–∏—Ç Metron:** 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω, 10000/–¥–µ–Ω—å
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø–∞—Å:** –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ 15 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω

## –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ

### –ü–æ–¥—Ö–æ–¥ 1: On-Demand (–ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–º–∏–∫—Å–∞ —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (`api/image/`)
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
3. –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤
4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º Metron URL –∏–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ –∫–æ–º–∏–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç
- ‚úÖ –ù–µ —Ç—Ä–∞—Ç–∏–º –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∏–∫—Å—ã
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Metron API
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ

### –ü–æ–¥—Ö–æ–¥ 2: Background (—Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

**–ö–æ–≥–¥–∞:** –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ —Ñ–æ–Ω–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∫–æ–º–∏–∫—Å–æ–≤

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```bash
npx tsx scripts/process-metron-images-background.ts
```

1. –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∫–æ–º–∏–∫—Å—ã —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º (`api/image/`)
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 4 —Å–µ–∫
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫—ç—à
4. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–∏–∫—Å—ã –∑–∞—Ä–∞–Ω–µ–µ
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ä–∞–∑—É –≤–∏–¥—è—Ç Metron –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–æ—á—å—é/–≤ —Ñ–æ–Ω–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è (~5 –¥–Ω–µ–π –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∏–∫—Å–æ–≤)
- ‚ö†Ô∏è –¢—Ä–∞—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∏–∫—Å—ã

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

1. **On-Demand** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Background** - –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–∏–∫—Å–æ–≤

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ 100 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö
npx tsx scripts/process-metron-images-background.ts --limit=100
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```typescript
import { getImageUrlWithMetron } from '@/lib/metron-api'

const thumb = await getImageUrlWithMetron(comic.thumb, comic.comicvine, 'thumb')
```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```typescript
import { getImageUrl } from '@/lib/utils'

const url = getImageUrl(comic.thumb, comic.comicvine, 'thumb')
// –ü—Ä–æ–≤–µ—Ä–∫–∞ Metron –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ SSR
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω–¥–µ–∫—Å –∫—ç—à–∞ (`data/metron-cache-index.json`)

```json
{
  "version": "1.0.0",
  "lastUpdated": "2025-12-17",
  "cachedImages": {
    "4050-12345": "https://static.metron.cloud/media/issue/2020/08/04/thor-v2-32.jpg"
  },
  "checkedIds": ["4050-11111"]
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –•—Ä–∞–Ω–∏–º –ø–æ–ª–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ –Ω—É–∂–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å)
- –õ–µ–≥–∫–∏–π —Ñ–∞–π–ª: ~500KB –¥–ª—è 100,000 –∑–∞–ø–∏—Å–µ–π
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫: O(1) —á–µ—Ä–µ–∑ Map

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–∞–∑–º–µ—Ä—ã

- **–ò–Ω–¥–µ–∫—Å**: ~500KB –¥–ª—è 100,000 –∑–∞–ø–∏—Å–µ–π
- **–ó–∞–≥—Ä—É–∑–∫–∞**: <10ms
- **–ü–æ–∏—Å–∫**: O(1) —á–µ—Ä–µ–∑ Map

### –õ–∏–º–∏—Ç—ã

- **15 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω** (–∑–∞–¥–µ—Ä–∂–∫–∞ 4 —Å–µ–∫)
- **~9000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å** (—Å –∑–∞–ø–∞—Å–æ–º –æ—Ç 10000)
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: ~5 –¥–Ω–µ–π –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∏–∫—Å–æ–≤ (–ø—Ä–∏ —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ)

## –ü—Ä–∏–º–µ—Ä—ã

### On-Demand

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–º–∏–∫—Å–∞
const url = "https://comicvine.gamespot.com/api/image/scale_large/12345.jpg"
const result = await getImageUrlWithMetron(url, 4050-12345)
// –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ: "https://static.metron.cloud/media/issue/2020/08/04/thor-v2-32.jpg"
// –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL
```

### Background

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∫–æ–º–∏–∫—Å—ã
npx tsx scripts/process-metron-images-background.ts

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ 100
npx tsx scripts/process-metron-images-background.ts --limit=100
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```typescript
import { getCacheStats } from '@/lib/metron-api'

const stats = getCacheStats()
console.log(`–ù–∞–π–¥–µ–Ω–æ –≤ Metron: ${stats.cachedCount}`)
console.log(`–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤—Å–µ–≥–æ: ${stats.checkedCount}`)
```

## –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã

**Q: –ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ?**  
A: –ì–∏–±—Ä–∏–¥–Ω—ã–π - on-demand –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, background –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–∏–∫—Å–æ–≤

**Q: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∫–æ–º–∏–∫—Å–æ–≤?**  
A: ~5 –¥–Ω–µ–π –ø—Ä–∏ —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ (—Å —É—á–µ—Ç–æ–º –ª–∏–º–∏—Ç–æ–≤)

**Q: –ú–æ–∂–Ω–æ –ª–∏ —É—Å–∫–æ—Ä–∏—Ç—å?**  
A: –ù–µ—Ç, –ª–∏–º–∏—Ç—ã Metron API —Å—Ç—Ä–æ–≥–∏–µ. –ù–æ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–∏–∫—Å—ã

**Q: –ß—Ç–æ –µ—Å–ª–∏ Metron API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?**  
A: –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ComicVine URL

