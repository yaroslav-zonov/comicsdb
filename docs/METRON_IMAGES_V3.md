# üñºÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Metron (v3 - –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ URL

1. **–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ComicVine** (`/a/uploads/scale_large/...`)
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –∫–∞–∫ –µ—Å—Ç—å
   - ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º Metron

2. **–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç ComicVine** (`https://comicvine.gamespot.com/api/image/scale_large/...`)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º Metron API
   - ‚úÖ –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º Metron URL, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

```
URL ComicVine ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
  ‚îú‚îÄ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (/a/uploads/) ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å ‚úÖ
  ‚îî‚îÄ –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (api/image) ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º Metron
      ‚îú‚îÄ –ù–∞–π–¥–µ–Ω–æ –≤ Metron ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º Metron URL ‚úÖ
      ‚îî‚îÄ –ù–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL ‚ö†Ô∏è
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω–¥–µ–∫—Å –∫—ç—à–∞ (`data/metron-cache-index.json`)

```json
{
  "version": "1.0.0",
  "lastUpdated": "2025-12-17",
  "cachedIds": ["4050-12345", "4050-67890"],  // ID —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ Metron
  "checkedIds": ["4050-11111", "4050-22222"]  // ID, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ)
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–µ–≥–∫–∏–π —Ñ–∞–π–ª: ~500KB –¥–ª—è 100,000 ID
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫: O(1) —á–µ—Ä–µ–∑ Set
- –ò–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

## Metron API

### –ó–∞–ø—Ä–æ—Å

```
GET https://metron.cloud/api/v1/issue/?cv_id={comicvineId}
```

### –û—Ç–≤–µ—Ç

```json
[
  {
    "id": 12345,
    "cv_id": 4050-12345,
    "image": "/media/image/thumb/12345.jpg",
    "thumb": "/media/image/thumb/12345.jpg",
    ...
  }
]
```

### –õ–∏–º–∏—Ç—ã

- **30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É** = –∑–∞–¥–µ—Ä–∂–∫–∞ 2.5 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **10000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å** = –º–∞–∫—Å–∏–º—É–º ~9000 –≤ –¥–µ–Ω—å (—Å –∑–∞–ø–∞—Å–æ–º)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

```typescript
import { getImageUrl } from '@/lib/utils'

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
const url = getImageUrl(comic.thumb, comic.comicvine, 'thumb')
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ –µ—Å—Ç—å
- –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL (–ø—Ä–æ–≤–µ—Ä–∫–∞ Metron –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

```typescript
import { getImageUrlWithMetron } from '@/lib/metron-api'

// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Metron –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
const url = await getImageUrlWithMetron(comic.thumb, comic.comicvine, 'thumb')
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ –µ—Å—Ç—å
- –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Metron –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º Metron)

```typescript
const url = "https://comicvine.gamespot.com/a/uploads/scale_large/12345.jpg"
const result = getImageUrl(url, 4050-12345)
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "https://comicvine.gamespot.com/a/uploads/scale_large/12345.jpg"
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–ø—Ä–æ–≤–µ—Ä—è–µ–º Metron)

```typescript
const url = "https://comicvine.gamespot.com/api/image/scale_large/12345.jpg"
const result = await getImageUrlWithMetron(url, 4050-12345)
// –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –≤ Metron: "https://metron.cloud/media/image/thumb/12345.jpg"
// –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: "https://comicvine.gamespot.com/api/image/scale_large/12345.jpg"
```

## –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API

### –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥—å—é –∑–∞–ø—Ä–æ—Å–æ–≤:

1. –ó–∞–ø—Ä–æ—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2.5 —Å–µ–∫ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```typescript
import { getCacheStats } from '@/lib/metron-api'

const stats = getCacheStats()
console.log(`–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${stats.checkedCount}`)
console.log(`–ù–∞–π–¥–µ–Ω–æ –≤ Metron: ${stats.cachedCount}`)
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–∞–∑–º–µ—Ä—ã

- **–ò–Ω–¥–µ–∫—Å**: ~500KB –¥–ª—è 100,000 ID
- **–ó–∞–≥—Ä—É–∑–∫–∞**: <10ms
- **–ü–æ–∏—Å–∫**: O(1) —á–µ—Ä–µ–∑ Set

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**: –ò–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤**: –°–æ–±–ª—é–¥–∞–µ–º –ª–∏–º–∏—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞**: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ regex

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```typescript
// app/publishers/[publisherId]/[seriesId]/[comicId]/page.tsx
const thumb = await getImageUrlWithMetron(comic.thumb, comic.comicvine, 'thumb')
```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```typescript
// components/ComicCard.tsx
const url = getImageUrl(comic.thumb, comic.comicvine, 'thumb')
// –ü—Ä–æ–≤–µ—Ä–∫–∞ Metron –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ SSR
```

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ v2:
1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ñ–æ—Ä–º–∞—Ç URL
2. –°—Ç–∞—Ä—ã–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å
3. –ù–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API

## –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã

**Q: –ß—Ç–æ –µ—Å–ª–∏ Metron API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?**  
A: –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ComicVine URL

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫—ç—à?**  
A: –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏)

**Q: –ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à?**  
A: –î–∞, —É–¥–∞–ª–∏—Ç–µ ID –∏–∑ `checkedIds` –≤ –∏–Ω–¥–µ–∫—Å–µ

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [METRON_IMAGES_V3_QUICKSTART.md](../METRON_IMAGES_V3_QUICKSTART.md) - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- [METRON_IMAGES_COMPARISON.md](./METRON_IMAGES_COMPARISON.md) - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

