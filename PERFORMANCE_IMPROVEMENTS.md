# –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ComicsDB

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º, –≤–Ω–µ—Å—ë–Ω–Ω—ã–º –≤ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞.

## üìä –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤

**–§–∞–π–ª:** [app/publishers/page.tsx](app/publishers/page.tsx)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –í–°–ï –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –ø–∞–º—è—Ç—å (100+ –∑–∞–ø–∏—Å–µ–π)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–µ–ª–∞–ª–æ—Å—å 2 –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î (count series + count comics)
- **–ò—Ç–æ–≥–æ:** ~200+ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å GROUP BY –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
SELECT
  p.id,
  p.name,
  COUNT(DISTINCT s.id) as seriesCount,
  COUNT(DISTINCT c.id) as comicsCount
FROM cdb_publishers p
LEFT JOIN cdb_series s ON ...
LEFT JOIN cdb_comics c ON ...
GROUP BY p.id, p.name
```

**–£–ª—É—á—à–µ–Ω–∏–µ:**
```sql
-- –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –≤ –ë–î
SELECT
  p.id,
  p.name,
  COUNT(DISTINCT s.id) as seriesCount,
  COUNT(DISTINCT c.id) as comicsCount,
  COUNT(*) OVER() as total_count  -- –ü–æ–ª—É—á–∞–µ–º total –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
FROM cdb_publishers p
LEFT JOIN cdb_series s ON ...
LEFT JOIN cdb_comics c ON ...
GROUP BY p.id, p.name
ORDER BY ... -- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –ë–î
LIMIT X OFFSET Y
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 200+
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ MySQL, –∞ –Ω–µ –≤ JavaScript
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (LIMIT/OFFSET)
- ‚úÖ COUNT(*) OVER() –¥–ª—è total –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ **~50-100 —Ä–∞–∑**

---

### 2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ FreshReleasesServer

**–§–∞–π–ª:** [components/FreshReleasesServer.tsx](components/FreshReleasesServer.tsx)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–≥—Ä—É–∂–∞–ª–æ—Å—å 200 –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –≤—Ä—É—á–Ω—É—é –≤ –ø–∞–º—è—Ç–∏ JavaScript
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ Prisma –∑–∞–ø—Ä–æ—Å—ã (include)

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL —Å COALESCE
ORDER BY COALESCE(c.date, c.pdate, c.adddate) DESC
LIMIT 200
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –ë–î (MySQL), –∞ –Ω–µ –≤ JS
- ‚úÖ –£–±—Ä–∞–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JOIN
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ ~2-3x

---

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª—ã:**
- [lib/search-queries.ts](lib/search-queries.ts)
- [lib/search-helpers.ts](lib/search-helpers.ts)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è `searchByScanlators` –¥–µ–ª–∞–ª–∞ 2 –∑–∞–ø—Ä–æ—Å–∞:
  1. SELECT —Å LIMIT/OFFSET
  2. –û—Ç–¥–µ–ª—å–Ω—ã–π COUNT(*) –¥–ª—è total
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –ø–æ–∏—Å–∫–∞
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ò—Å–ø–æ–ª—å–∑—É–µ–º COUNT(*) OVER() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è total –≤ —Ç–æ–º –∂–µ –∑–∞–ø—Ä–æ—Å–µ
SELECT
  c.*,
  s.name as series_name,
  p.name as publisher_name,
  COUNT(*) OVER() as total_count
FROM cdb_comics c
INNER JOIN cdb_series s ON c.serie = s.id
INNER JOIN cdb_publishers p ON s.publisher_id = p.id
WHERE ...
ORDER BY ... -- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ SQL
LIMIT X OFFSET Y
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 2 (–æ–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è COUNT(*) OVER())
- ‚úÖ JOIN –≤–º–µ—Å—Ç–æ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è series –∏ publishers
- ‚úÖ ORDER BY –≤ SQL –≤–º–µ—Å—Ç–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ JS
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ö–µ–ª–ø–µ—Ä—ã
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ ~5-10x

---

### 4. ‚úÖ –í–Ω–µ–¥—Ä—ë–Ω React Query –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª—ã:**
- [components/QueryProvider.tsx](components/QueryProvider.tsx)
- [app/layout.tsx](app/layout.tsx)

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
<QueryClientProvider client={queryClient}>
  {children}
</QueryClientProvider>
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `staleTime`: 5 –º–∏–Ω—É—Ç (–¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏)
- `gcTime`: 10 –º–∏–Ω—É—Ç (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à–µ)
- `retry`: 1 (–æ–¥–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
- `refetchOnWindowFocus`: false (—ç–∫–æ–Ω–æ–º–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤–∏–∑–∏—Ç–∞—Ö

---

### 5. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω Next.js Image

**–§–∞–π–ª:** [next.config.js](next.config.js)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```js
images: {
  formats: ['image/webp'],          // WebP –¥–ª—è –ª—É—á—à–µ–≥–æ —Å–∂–∞—Ç–∏—è
  minimumCacheTTL: 60 * 60 * 24 * 30, // 30 –¥–Ω–µ–π –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞
  deviceSizes: [640, 750, 828, 1080, 1200],
  imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP
- ‚úÖ Responsive images (srcset)
- ‚úÖ Lazy loading –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –ö—ç—à –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ 30 –¥–Ω–µ–π

---

### 6. ‚úÖ –°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥

**–§–∞–π–ª:** [lib/config.ts](lib/config.ts)

**–ß—Ç–æ –≤—ã–Ω–µ—Å–µ–Ω–æ:**
```typescript
export const APP_CONFIG = {
  pagination: {
    defaultPageSize: 100,
    publishersPageSize: 100,
    searchPageSize: 100,
  },
  revalidate: {
    homePage: 30,      // ISR - 30 —Å–µ–∫—É–Ω–¥
    publishers: 60,    // ISR - 60 —Å–µ–∫—É–Ω–¥
    genres: 60,
    sites: 60,
  },
  freshReleases: {
    daysAgo: 7,       // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
    limit: 200,       // –ú–∞–∫—Å–∏–º—É–º —Ä–µ–ª–∏–∑–æ–≤
  },
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª –≤ –∫–æ–¥–µ
- ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (TypeScript)

---

## üéØ –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ~200+ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ –≤ JS
- –î–≤–æ–π–Ω—ã–µ COUNT –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ú–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–æ–±—ã—á–Ω–æ 1-2)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ SQL
- ‚úÖ –û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (COUNT(*) OVER())
- ‚úÖ React Query –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ WebP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
- ‚úÖ TypeScript type guards –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|-----|-------|-----------|
| –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ | ~2-5 —Å–µ–∫ | ~100-300 –º—Å | **10-50x** |
| –°–≤–µ–∂–∏–µ —Ä–µ–ª–∏–∑—ã | ~500-800 –º—Å | ~150-250 –º—Å | **2-3x** |
| –ü–æ–∏—Å–∫ –ø–æ —Å–∫–∞–Ω–ª–µ–π—Ç–µ—Ä–∞–º | ~1-3 —Å–µ–∫ | ~200-400 –º—Å | **5-10x** |

*–ó–∞–º–µ—Ä—ã –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ, –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î –∏ –Ω–∞–≥—Ä—É–∑–∫–∏*

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ MySQL** - –¥–æ–±–∞–≤–∏—Ç—å FULLTEXT –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ª–µ–π `name`, `translate`, `edit`
2. **Database indexing** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
3. **Streaming SSR** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Suspense + streaming –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
4. **API Route caching** - –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ API endpoints
5. **Database connection pooling** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π Prisma

---

## üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏

### –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```typescript
import { searchByScanlators } from '@/lib/search-queries'

const results = await searchByScanlators('KazikZ', 1, 'adddate_desc')
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```typescript
import { APP_CONFIG } from '@/lib/config'

const pageSize = APP_CONFIG.pagination.searchPageSize
const revalidate = APP_CONFIG.revalidate.homePage
```

### –•–µ–ª–ø–µ—Ä—ã –ø–æ–∏—Å–∫–∞:
```typescript
import { getOrderByClause, extractNameFromCsv } from '@/lib/search-helpers'

const orderBy = getOrderByClause('name_asc') // 's.name ASC'
const name = extractNameFromCsv('John, Jane, Bob', 'jane') // 'Jane'
```

---

–°–æ–∑–¥–∞–Ω–æ: 2025-12-15
–ê–≤—Ç–æ—Ä: Claude Sonnet 4.5 + Yaroslav Zonov
