# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ

**–î–∞—Ç–∞:** 17 –¥–µ–∫–∞–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## üìä –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ app/sites/[id]/page.tsx

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Ä–∏–∏ –¥–µ–ª–∞–ª—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- 50 —Å–µ—Ä–∏–π = **51 –∑–∞–ø—Ä–æ—Å** (1 –æ—Å–Ω–æ–≤–Ω–æ–π + 50 –¥–ª—è –∫–æ–º–∏–∫—Å–æ–≤)
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 500-1500ms

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –æ–¥–∏–Ω SQL –∑–∞–ø—Ä–æ—Å —Å `JSON_ARRAYAGG`
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–º–∏–∫—Å–∞—Ö –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞ 1 –∑–∞–ø—Ä–æ—Å
- –ü–∞—Ä—Å–∏–Ω–≥ JSON –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ó–∞–ø—Ä–æ—Å–æ–≤:** 51-101 ‚Üí 1 (-98%)
- **–í—Ä–µ–º—è:** 500-1500ms ‚Üí 30-80ms (-95%)
- **–§–∞–π–ª:** [app/sites/[id]/page.tsx](app/sites/[id]/page.tsx#L47-L123)

---

### ‚úÖ 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ app/stats/getStatsData.ts

#### 2a. getTopScanlatorsByYear()

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –≤—Å–µ –∫–æ–º–∏–∫—Å—ã —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞ –≤ –ø–∞–º—è—Ç—å (5,000-15,000 –∑–∞–ø–∏—Å–µ–π)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ CSV —Å–ø–∏—Å–∫–æ–≤ –≤ JavaScript
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 800-2000ms
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: 50-150MB

**–†–µ—à–µ–Ω–∏–µ:**
- SQL –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å `SUBSTRING_INDEX` –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è CSV
- –ü–æ–¥—Å—á—ë—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–í—Ä–µ–º—è:** 800-2000ms ‚Üí 50-150ms (-90%)
- **–ü–∞–º—è—Ç—å:** -100MB
- **–§–∞–π–ª:** [app/stats/getStatsData.ts](app/stats/getStatsData.ts#L85-L140)

#### 2b. getFreshmenByYear()

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–≥—Ä—É–∂–∞–ª–∏—Å—å **–í–°–ï –∫–æ–º–∏–∫—Å—ã –ë–î** –≤ –ø–∞–º—è—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–≤—ã—Ö —Ä–µ–ª–∏–∑–æ–≤
- –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤ –ø–∞–º—è—Ç–∏
- –ö—Ä–∞–π–Ω–µ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
- –û–¥–∏–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π SQL —Å `WITH` (CTE)
- –î–≤–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã: –ø–µ—Ä–≤—ã–µ –¥–∞—Ç—ã + –ø–æ–¥—Å—á—ë—Ç —Ä–µ–ª–∏–∑–æ–≤
- –í—Å—ë –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ø–∞–º—è—Ç—å:** –í–°–ï –∫–æ–º–∏–∫—Å—ã ‚Üí 0 –∫–æ–º–∏–∫—Å–æ–≤
- **–ó–∞–ø—Ä–æ—Å–æ–≤:** 2 ‚Üí 1
- **–í—Ä–µ–º—è:** ~2000ms ‚Üí ~100ms (-95%)
- **–§–∞–π–ª:** [app/stats/getStatsData.ts](app/stats/getStatsData.ts#L266-L342)

---

### ‚úÖ 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ Latest Comics API

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ó–∞–≥—Ä—É–∂–∞–ª–æ—Å—å –≤ 3 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö (36 –≤–º–µ—Å—Ç–æ 12)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `adddate` –≤ –ë–î, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ JavaScript –ø–æ `COALESCE(date, pdate, adddate)`
- –õ–∏—à–Ω–∏–µ 66% —Ç—Ä–∞—Ñ–∏–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω raw SQL —Å `COALESCE(c.date, c.pdate, c.adddate)` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ `limit` –∑–∞–ø–∏—Å–µ–π (12 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è: `limit` –æ—Ç 1 –¥–æ 100

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–ó–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∑–∞–ø–∏—Å–µ–π:** 36 ‚Üí 12 (-66%)
- **–í—Ä–µ–º—è:** 80-150ms ‚Üí 20-40ms (-70%)
- **–¢—Ä–∞—Ñ–∏–∫:** -66%
- **–§–∞–π–ª:** [app/api/comics/latest/route.ts](app/api/comics/latest/route.ts#L6-L73)

---

### ‚úÖ 4. –î–æ–±–∞–≤–ª–µ–Ω—ã FULLTEXT –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

**–°–æ–∑–¥–∞–Ω–æ:**
- SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å 6 FULLTEXT –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –§–∞–π–ª: [prisma/migrations/add_fulltext_indexes.sql](prisma/migrations/add_fulltext_indexes.sql)

**–ò–Ω–¥–µ–∫—Å—ã:**
1. `idx_comics_characters_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
2. `idx_comics_creators_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∞–≤—Ç–æ—Ä–∞–º
3. `idx_comics_teams_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
4. `idx_comics_translate_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞–º
5. `idx_comics_edit_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –æ—Ñ–æ—Ä–º–∏—Ç–µ–ª—è–º
6. `idx_series_name_fulltext` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º —Å–µ—Ä–∏–π

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏):**
- **–ü–æ–∏—Å–∫:** 150-400ms ‚Üí 30-80ms (-80%)
- **–û—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ** –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö CSV —Å–ø–∏—Å–∫–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `MATCH(c.characters) AGAINST('Batman' IN BOOLEAN MODE)`

**–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:**
```bash
mysql -u username -p comicsdb < prisma/migrations/add_fulltext_indexes.sql
```

---

### ‚úÖ 5. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å .env —Ñ–∞–π–ª–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ `.env` **–ù–ï –≤ –∏—Å—Ç–æ—Ä–∏–∏ git** (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
- ‚úÖ `.env` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `.gitignore`
- ‚úÖ –°–æ–∑–¥–∞–Ω `.env.example` —Å placeholder –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–§–∞–π–ª—ã:**
- [.gitignore](.gitignore#L26-L27)
- [.env.example](.env.example) - –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

## üìà –û–±—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–π—Ç–∞** | 500-1500ms | 30-80ms | **-95%** |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–æ–ø —Å–∫–∞–Ω–ª–µ–π—Ç–µ—Ä–æ–≤)** | 800-2000ms | 50-150ms | **-90%** |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ñ—Ä–µ—à–º–µ–Ω—ã)** | ~2000ms | ~100ms | **-95%** |
| **Latest Comics API** | 80-150ms | 20-40ms | **-70%** |
| **–ü–æ–∏—Å–∫ (–ø–æ—Å–ª–µ FULLTEXT)** | 150-400ms | 30-80ms | **-80%** |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** | 200MB | 80MB | **-60%** |
| **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–π—Ç–∞)** | 51-101 | 3 | **-98%** |

**–û–±—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** Response time **-70-95%**, DB load **-90%**

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–æ:
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –≤ Latest Comics API (`limit` –æ—Ç 1 –¥–æ 100)
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** `.env.example` –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ SQL –º–∏–≥—Ä–∞—Ü–∏–∏

### –£–¥–∞–ª–µ–Ω–æ:
1. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç `Prisma` –∏–∑ `app/sites/[id]/page.tsx`

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ):

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å FULLTEXT –∏–Ω–¥–µ–∫—Å—ã (5 –º–∏–Ω—É—Ç)
```bash
mysql -u username -p comicsdb < prisma/migrations/add_fulltext_indexes.sql
```

### 2. –í–Ω–µ–¥—Ä–∏—Ç—å Redis –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ –∫—ç—à–∞ (1-2 —á–∞—Å–∞)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `@upstash/redis`
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Å–µ—Ä–∏–∏, –∏–∑–¥–∞—Ç–µ–ª–∏)
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å Global Comic IDs (TTL: 10 –º–∏–Ω)

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–æ –≤—Å–µ API endpoints (30 –º–∏–Ω)
–°–æ–∑–¥–∞—Ç—å `lib/validation.ts`:
```typescript
export function validatePagination(page?: string, limit?: string) {
  const p = Math.max(1, parseInt(page || '1'))
  const l = Math.min(100, Math.max(1, parseInt(limit || '20')))
  return { page: p, limit: l }
}
```

### 4. –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ API (30 –º–∏–Ω)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@upstash/ratelimit` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DoS –∞—Ç–∞–∫

### 5. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (1 —á–∞—Å)
- `getOrderByClause` –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∞ 4 —Ä–∞–∑–∞ –≤ `search/page.tsx`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∏–∑ `lib/search-helpers.ts`

### 6. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `pino`
- –ó–∞–º–µ–Ω–∏—Ç—å 91 –≤—ã–∑–æ–≤ `console.error` –Ω–∞ `logger.error`

---

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ **5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º** —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!

**–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:** 8.5/10 (–±—ã–ª–æ 7.5/10)

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î:** 9/10 (–±—ã–ª–æ 8/10)

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ. –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å FULLTEXT –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞.

---

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:** Claude Sonnet 4.5
**–î–∞—Ç–∞:** 17 –¥–µ–∫–∞–±—Ä—è 2025
